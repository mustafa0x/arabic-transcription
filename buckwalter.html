<!doctype html>
<meta charset="utf-8">
<title>Buckwalter</title>
<link href="style.css" rel="stylesheet">

<h1>Buckwalter To Arabic</h1>
<h2>Buckwalter</h2>
<textarea id="in"></textarea>
<h2>Arabic</h2>
<textarea id="out"></textarea>

<script>
const $ = s => document.querySelector(s);
Node.prototype.on = Node.prototype.addEventListener;

let buckwalter = [
    ["'", "ء"], ["|", "آ"], [">", "أ"], ["&", "ؤ"], ["<", "إ"], ["}", "ئ"], ["A", "ا"],
    ["b", "ب"], ["p", "ة"], ["t", "ت"], ["v", "ث"], ["j", "ج"], ["H", "ح"], ["x", "خ"],
    ["d", "د"], ["*", "ذ"], ["r", "ر"], ["z", "ز"], ["s", "س"], ["$", "ش"], ["S", "ص"],
    ["D", "ض"], ["T", "ط"], ["Z", "ظ"], ["E", "ع"], ["g", "غ"], ["_", "ـ"], ["f", "ف"],
    ["q", "ق"], ["k", "ك"], ["l", "ل"], ["m", "م"], ["n", "ن"], ["h", "ه"], ["w", "و"],
    ["Y", "ى"], ["y", "ي"], ["F", "ً"], ["N", "ٌ"], ["K", "ٍ"], ["a", "َ"], ["u", "ُ"],
    ["i", "ِ"], ["~", "ّ"], ["o", "ْ"], ["`", "ٰ"], ["{", "ٱ"], ["^", "ٓ"], ["#", "ٔ"],
    [":", "ۜ"], ["@", "۟"], ['"', "۠"], ["[", "ۢ"], [";", "ۣ"], [",", "ۥ"], [".", "ۦ"],
    ["!", "ۨ"], ["-", "۪"], ["+", "۫"], ["%", "۬"], ["]", "ۭ"]
];

function replace(str, a, b) {
    if (b.indexOf(a) > -1)
        return str; // Avoid infinite loop

    let index = 0;
    do {
        str = str.replace(a, b);
    } while ((index = str.indexOf(a, index + 1)) > -1);
    return str;
}

$('#in').on('keyup', e => {
    let val = $('#in').value;
    if (val.length > 2000) {
        alert('The text is too long; aborting.');
        return;
    }

    buckwalter.forEach(r => val = replace(val, r[0], r[1]));
    $('#out').value = val;
});

$('#in').value = 'marHabFA';
$('#in').dispatchEvent(new CustomEvent('keyup'));
</script>
